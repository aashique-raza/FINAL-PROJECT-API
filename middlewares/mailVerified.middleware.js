
import User from "../models/user.model.js";
import errorHandler from "../utility/errorHandler.utility.js";

const checkEmailVerification = async (req, res, next) => {
    try {
        console.log('ye hai id',req.user.userId)
        const userId = req.user.userId;
        const user = await User.findById(userId);
        console.log(user)

        if (!user || !user.isEmailVerified) {
            // Call next with an error object generated by the errorHandler utility
            return next(errorHandler(403, 'Email not verified'));
        }

        // If email is verified, proceed to the next middleware or route handler
        next();
    } catch (error) {
        // Log the error
        console.error('Error checking email verification:', error);
        // Pass the error to the next middleware for centralized error handling
        next(error);
    }
};

export default checkEmailVerification;
